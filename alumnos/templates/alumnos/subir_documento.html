{% extends "base_generic_alumnos.html" %}

{% block content %}
<style>
    #formularioCorregirDocumento label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    text-align: left;
}

#formularioCorregirDocumento input[type="text"],
#formularioCorregirDocumento input[type="date"],
#formularioCorregirDocumento input[type="file"],
#formularioCorregirDocumento textarea,
#formularioCorregirDocumento select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}
</style>
<div id="fondo" class="letra_texto">
    <div class="contenedor_principal letra_texto">
        <h1 class="letra_titulos">Subir documentos</h1>
        <!-- Bloque para mostrar mensajes -->
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="contenedor_formulario">
            {% if not documento %}
            <p>Para subir un documento al repositorio es necesario llenar el siguiente formulario.</p>
            <form id="formularioDocumento" method="post" action="" enctype="multipart/form-data">
                {% csrf_token %}
                <label for="nombreDocumento">Nombre del documento:</label>
                <input type="text" id="nombreDocumento" name="nombre_documento" required>
            
                <label for="resumen">Resumen:</label>
                <textarea id="resumen" name="resumen" required></textarea>
            
                <label for="nombreAutor">Nombre del autor:</label>
                <input type="text" id="nombreAutor" name="nombre_autor" required>
            
                <label for="sinodales">Sinodales:</label>
                <input type="text" id="sinodales" name="sinodales" required>
            
                <label for="tipo">Tipo:</label>
                <select id="tipo" name="tipo" required>
                    <option value="TE">Tesis</option>
                    <option value="TT">Trabajo Terminal</option>
                    <option value="OT">Otro</option>
                </select>
            
                <label for="fechaElaboracion">Fecha de elaboración:</label>
                <input type="date" id="fechaElaboracion" name="fecha_elaboracion" required>
            
                <label for="convocatoriaTitulacion">Convocatoria de titulación:</label>
                <input type="text" id="convocatoriaTitulacion" name="convocatoria" required>
            
                <label for="documento">Subir documento:</label>
                <input type="file" id="documento" name="documento" accept=".pdf" required>
            
                <input type="submit" value="Enviar">
            </form>
            {% elif documento.aceptado %}
            <p class="letra_preguntas">Tu documento ha sido aceptado. No es necesario subir otro documento.</p>
            
            {% else %}
            <p class="letra_preguntas">Ya has subido un documento. Esperando Revisión.</p>
            {% if revisado %}
            <h2>Retroalimentación de Revisión</h2>
            <table class="tabla-revision">
                <thead>
                    <tr>
                        <th>Criterio</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Título adecuado</td>
                        <td>{{ revisado.titulo_adecuado|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Objetivos cumplidos</td>
                        <td>{{ revisado.objetivos_cumplidos|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Referencias correctas</td>
                        <td>{{ revisado.referencias_correctas|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Errores ortográficos</td>
                        <td>{{ revisado.errores_ortograficos|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Estructura clara</td>
                        <td>{{ revisado.estructura_clara|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Contenido coherente</td>
                        <td>{{ revisado.contenido_coherente|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Normas de formato</td>
                        <td>{{ revisado.normas_formato|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Metodología descrita</td>
                        <td>{{ revisado.metodologia_descrita|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Resultados presentados</td>
                        <td>{{ revisado.resultados_presentados|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Discusión adecuada</td>
                        <td>{{ revisado.discusion_adecuada|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Conclusiones pertinentes</td>
                        <td>{{ revisado.conclusiones_pertinentes|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Suficientes referencias</td>
                        <td>{{ revisado.suficientes_referencias|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Introducción contextualiza</td>
                        <td>{{ revisado.introduccion_contextualiza|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Gráficos y tablas adecuados</td>
                        <td>{{ revisado.graficos_tablas_adecuados|yesno:"Sí,No" }}</td>
                    </tr>
                    <tr>
                        <td>Resumen claro y conciso</td>
                        <td>{{ revisado.resumen_claro_conciso|yesno:"Sí,No" }}</td>
                    </tr>
                </tbody>
            </table>
            <p>Comentarios: {{ revisado.comentarios }}</p>
            {% if not revisado.aceptado %}
            <button id="corregirDocumento" class="dropbtn_base">Corregir Documento</button>
            
            <!-- Formulario de corrección (oculto por defecto) -->
            <form id="formularioCorregirDocumento" method="post" action="" enctype="multipart/form-data" style="display: none;">
                {% csrf_token %}
                <label for="nombreDocumento">Nombre del documento:</label>
                <input type="text" id="nombreDocumento" name="nombre_documento" value="{{ documento.nombre_documento }}" required>
            
                <label for="resumen">Resumen:</label>
                <textarea id="resumen" name="resumen" required>{{ documento.resumen }}</textarea>
            
                <label for="nombreAutor">Nombre del autor:</label>
                <input type="text" id="nombreAutor" name="nombre_autor" value="{{ documento.nombre_autor }}" required>
            
                <label for="sinodales">Sinodales:</label>
                <input type="text" id="sinodales" name="sinodales" value="{{ documento.sinodales }}" required>
            
                <label for="tipo">Tipo:</label>
                <select id="tipo" name="tipo" required>
                    <option value="TE" {% if documento.tipo == "TE" %}selected{% endif %}>Tesis</option>
                    <option value="TT" {% if documento.tipo == "TT" %}selected{% endif %}>Trabajo Terminal</option>
                    <option value="OT" {% if documento.tipo == "OT" %}selected{% endif %}>Otro</option>
                </select>
            
                <label for="fechaElaboracion">Fecha de elaboración:</label>
                <input type="date" id="fechaElaboracion" name="fecha_elaboracion" value="{{ documento.fecha_elaboracion }}" required>
            
                <label for="convocatoriaTitulacion">Convocatoria de titulación:</label>
                <input type="text" id="convocatoriaTitulacion" name="convocatoria" value="{{ documento.convocatoria }}" required>
            
                <label for="documento">Subir nuevo documento:</label>
                <input type="file" id="documento" name="documento" accept=".pdf" required>
            
                <input type="submit" value="Enviar Corrección">
            </form>
            {% endif %}
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.getElementById('corregirDocumento').addEventListener('click', function() {
        document.getElementById('formularioCorregirDocumento').style.display = 'block';
    });
</script>
{% endblock %}
